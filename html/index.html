{{define "tmpl"}}

<!-- This is the homepage of the marketplace app.   -->
<!-- JavaScript to check for cookie -->
<script>

    // This checks to see if there's a cookie present
    function checkCookie() {
        var sessionToken = document.cookie.match(/session_token=([^;]*)/);
        if (sessionToken !== null && sessionToken !== "") {
            // Send AJAX request to backend to verify the cookie
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/verify-cookie/' + sessionToken[1], true);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    // User is logged in, display their posted items
                    document.getElementById('user-items').style.display = 'block';
                } else {
                    // User is not logged in, display all posted items
                    document.getElementById('all-items').style.display = 'block';
                }
            };
            xhr.send();
        } else {
            // User is not logged in, display all posted items
            document.getElementById('all-items').style.display = 'block';
        }
    }

    window.onload = function () {
        checkCookie();
    }
    // alert("After checkcookie");

</script>

<!-- if the user is logged in, meaning, if there's a cookie found by the web server 
    written in golang, then a list of items that the user has posted from newest 
    to oldest will be displayed if any.-->
<div id="user-items" style="display: none;">
    <h2>Your Posted Items:</h2>
    <!-- Display list of user's posted items here -->
</div>

<!-- if the user is not logged in, then this will display a list of items posted for sale
by all users based on the time they were posted at from newest to oldest. -->
<div id="all-items" style="display: none;">
    <h2>Latest Items:</h2>
    <script>
        fetch('/allItems')
            .then(response => {
                console.log(response.status, response.statusText);
                if (!response.ok) {
                    throw new Error('Network response was not ok NOOOOOOOOOOOOO :-(');
                }
                return response.json();
            })
            .then(items => {
                //alert(JSON.stringify(items));
                const allItemsDiv = document.getElementById('all-items');
                allItemsDiv.style.display = 'block';

                items.forEach(item => {
                    // Create parent div for item preview
                    const itemPreviewDiv = document.createElement('div');
                    itemPreviewDiv.className = 'itempreview';

                    // Create div for item name and image
                    const nameImageDiv = document.createElement('div');
                    nameImageDiv.style.display = 'flex';
                    nameImageDiv.style.justifyContent = 'space-between';

                    const nameH2 = document.createElement('h2');
                    nameH2.textContent = item.Name;
                    nameImageDiv.appendChild(nameH2);

                    // Create img element
                    const image = document.createElement('img');
                    image.src = item.PhotoURL;
                    image.alt = 'Item Image';
                    image.style.maxWidth = '300px'; // Set maximum width
                    image.style.height = 'auto'; // Adjust height automatically
                    nameImageDiv.appendChild(image);

                    // Create div for price
                    const priceH2 = document.createElement('h2');
                    priceH2.textContent = `$${item.Price}`; // Add $ sign before the price

                    // Create div for availability
                    const availabilityDiv = document.createElement('div');
                    availabilityDiv.className = 'availability'; // Add a Bootstrap class
                    availabilityDiv.textContent = item.IsSold ? 'Item is Available' : 'Item is Sold';

                    // Create div for description
                    const descriptionDiv = document.createElement('div');
                    const descriptionP = document.createElement('p');
                    descriptionP.textContent = item.Description;
                    descriptionDiv.appendChild(descriptionP);

                    // Append all divs to itemPreviewDiv
                    itemPreviewDiv.appendChild(nameImageDiv);
                    itemPreviewDiv.appendChild(priceH2);
                    itemPreviewDiv.appendChild(availabilityDiv);
                    itemPreviewDiv.appendChild(descriptionDiv);

                    // Append itemPreviewDiv to allItemsDiv
                    allItemsDiv.appendChild(itemPreviewDiv);
                });

            });

    </script>
    <br><br>
</div>



{{end}}